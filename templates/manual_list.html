<!doctype html><html lang="ar" dir="rtl"><head>
<meta charset="utf-8"><title>تقارير يدوية — {{ category }}</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css">
<style>body{max-width:1100px;margin:24px auto}</style></head>
<body class="p-3">
  <div class="d-flex justify-content-between mb-3">
    <h3>تقارير يدوية — {{ category }}</h3>
    <div>
      <a class="btn btn-primary" href="{{ url_for('manual_new', category=category) }}">➕ إنشاء</a>
      <form method="POST" action="{{ url_for('manual_generate', category=category) }}" style="display:inline" onsubmit="return gen(this)">
        <button class="btn btn-outline-secondary">📄 توليد</button>
      </form>
    </div>
  </div>
  <table class="table table-striped">
    <thead><tr><th>#</th><th>العنوان</th><th>الحالة</th><th>تاريخ</th><th></th></tr></thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r.id }}</td>
        <td><a href="{{ url_for('manual_view', rec_id=r.id) }}">{{ r.title }}</a></td>
        <td>{{ r.status }}</td>
        <td>{{ r.created_at }}</td>
        <td><a class="btn btn-sm btn-outline-primary" href="{{ url_for('manual_edit', rec_id=r.id) }}">✏️ تعديل</a></td>
      </tr>{% endfor %}
    </tbody>
  </table>
<script>
async function gen(form){
  const res = await fetch(form.action,{method:"POST"}); const j=await res.json();
  if(j.ok){window.open("/"+j.file,"_blank");}
  return false;
}
</script>
</body></html>
